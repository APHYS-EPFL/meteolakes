<!doctype html>
<html ng-app="lakeViewApp" ng-strict-di>
    <head>
        <meta charset="utf-8">

        <title>Forecasting Hydrodynamic Lake Model</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="description" content="3D forecasting hydrodynamic models for real-time lakes monitoring using Delft3D / Modélisations hydrodynamiques en 3D et temps réel pour suivre et prédire l'état des lacs.">

        <!-- Integrity hashes generated using https://www.srihash.org/ -->
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous">
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css"
              integrity="sha384-jbhYDFfm+l6mA6jJUD5X/yv7LoRqVSoV/P77fNwITqMNlHHVIdSwj3SexyasxFL/"
              crossorigin="anonymous">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/loading-animation.css">
        <link rel="apple-touch-icon" href="favicon-152.png">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"
                integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.min.js"
                integrity="sha384-V6/dyDFv85/V/Ktq3ez5B80/c9ZY7jV9c/319rqwNOz3h9CIPdd2Eve0UQBYMMr/"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"
                integrity="sha384-niXt6LHz3/5ICmM9SeKzwJ/Q+a+7097SlA8uRtZSe0ISV5OpJZEVngjobdrYk8UZ"
                crossorigin="anonymous"></script><!-- D3 v4.2.6 doesn't work without changes -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.0.3/pixi.min.js"
                integrity="sha384-l81Oviy56vaxUxI/cKDw9EHRakP0AOgBUqIhi+O436s3HuHprPtS0uBNO+ntcMH4"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.js"
                integrity="sha384-xIDZe7Rjf3zto7vxSiATvetbjxGp5h2blkw/D3E6xEAZNWn+FVroKGwI/156TkSs"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"
                integrity="sha384-ZAL5WXJ2KrnElgEB6zIkYibJOI6IbT/NAtVIbw+sDGkTg5kIO5tg2Ntfp/kY3Ijz"
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"
                integrity="sha384-7pfELK0arQ3VANqV4kiPWPh5wOsrfitjFGF/NdyHXUJ3JJPy/rNhasPtdkaNKhul"
                crossorigin="anonymous"></script>

        <script src="dist/js/bundle.min.js"></script>
    </head>

    <body ng-controller="TimeCtrl">
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">

                <div class="visible-xs-block lv-navbar-small-buttons">
                    <div class="pull-left">
                        <img src="img/coresim.png" style="width:35px;height:41px;margin:10px">
                        <h4 style="display:inline">Lake 3D Model</h4>
                    </div>
                    <div class="pull-right lv-controls-xs">
                        <div class="navbar-text"><strong><div style="font-size:60%" ng-bind="getDate()"></div><div style="font-size:130%" ng-bind="getTime()"></div></strong></div>
                        <button type="button" class="btn btn-default navbar-btn" ng-click="play()"><span class="glyphicon" ng-class="{'glyphicon-play': !isPlaying, 'glyphicon-pause': isPlaying}"></span></button>
                    </div>
                    <div class="btn-group btn-group-justified">
                        <div class="btn-group btn-group-sm">
                            <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                                {{ index[selection.lake].name }}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu lv-scrollable-menu">
                                <li ng-repeat="lake in index">
                                    <a href="#" ng-click="ChangeLake($index)">{{ lake.name }}</a>
                                </li>
                            </ul>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                                {{ "Year " + selection.year }}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu lv-scrollable-menu" role="menu">
                                <li ng-repeat="year in index[selection.lake].years">
                                    <a href="#" ng-click="ChangeYear(year)">{{ year }}</a>
                                </li>
                            </ul>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                                {{ "Week " + selection.week }}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right lv-scrollable-menu" role="menu">
                                <li ng-repeat="week in index[selection.lake].data.get(selection.year)">
                                    <a href="#" ng-click="ChangeWeek(week)">{{ PrettyPrintWeek(week) }}</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="hidden-xs">
                    <div class="pull-left">
                        <img src="img/coresim.png" class="lv-navbar-logo">
                    </div>
                    <a class="navbar-brand" href="#">Lake 3D Model</a>
                    <div class="btn-group navbar-btn">
                        <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                            {{ index[selection.lake].name }}
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu lv-scrollable-menu">
                            <li ng-repeat="lake in index">
                                <a href="#" ng-click="ChangeLake($index)">{{ lake.name }}</a>
                            </li>
                        </ul>
                    </div>
                    <div class="btn-group navbar-btn">
                        <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                            {{ "Year " + selection.year }}
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu lv-scrollable-menu" role="menu">
                            <li ng-repeat="year in index[selection.lake].years">
                                <a href="#" ng-click="ChangeYear(year)">{{ year }}</a>
                            </li>
                        </ul>
                    </div>
                    <div class="btn-group navbar-btn">
                        <button type="button" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                            {{ "Week " + selection.week }}
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu lv-scrollable-menu" role="menu">
                            <li ng-repeat="week in index[selection.lake].data.get(selection.year)">
                                <a href="#" ng-click="ChangeWeek(week)">{{ PrettyPrintWeek(week) }}</a>
                            </li>
                        </ul>
                    </div>
                    <div class="navbar-right">
                        <div class="btn-group lv-navbar-margin">
                            <button type="button" class="btn btn-default navbar-btn lv-slower" ng-click="slower()"><span class="glyphicon glyphicon-backward"></span></button>
                            <button type="button" class="btn btn-default navbar-btn" ng-click="play()"><span class="glyphicon" ng-class="{'glyphicon-play': !isPlaying, 'glyphicon-pause': isPlaying}"></span></button>
                            <button type="button" class="btn btn-default navbar-btn lv-faster" ng-click="faster()"><span class="glyphicon glyphicon-forward"></span></button>
                            <button type="button" class="btn btn-default navbar-btn" ng-click="stop()"><span class="glyphicon glyphicon-stop"></span></button>
                        </div>
                    </div>

                    <div>
                        <div class="btn-group pull-left lv-navbar-margin">
                            <button type="button" class="btn btn-default navbar-btn" ng-click="backward()"><span class="glyphicon glyphicon-step-backward"></span></button>
                            <button type="button" class="btn btn-default navbar-btn" ng-click="forward()"><span class="glyphicon glyphicon-step-forward"></span></button>
                        </div>
                        <div class="navbar-right"><p class="navbar-text"><strong>Date: <span ng-bind="getDate()"></span><span class="lv-divider-vertical"></span>Time: <span ng-bind="getTime()"></span></strong></p></div>
                        <div class="lv-timeslider">
                            <input type="range" ng-model="Time.tIndex" min="0" max="{{ Time.nSteps - 1 }}">
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <div class="lv-container-dynamic">
            <div class="row">
                <div ng-controller="TemperatureCtrl" class="col-sm-12 col-lg-6 lv-extra-padding">
                    <div>
                        <ol class="breadcrumb pull-right">
                            <li><a href="http://meteolakes.epfl.ch/validation/">Satellite validation</a></li>
                            <li><a href="{{ BUCHILLON_URL }}">In-situ measurements (Beta)</a></li>
                        </ol>
                        <h3>Temperature</h3>
                    </div>

                    <ul class="nav nav-tabs">
                        <li ng-class="{active: tab == 'surface'}"><a href="#" ng-click="setTab('surface')">Surface</a></li>
                        <li ng-class="{active: tab == 'sliceXZ', hidden: !sliceXZData.available}"><a href="#" ng-click="setTab('sliceXZ')">Transect 1</a></li>
                        <li ng-class="{active: tab == 'sliceYZ', hidden: !sliceYZData.available}"><a href="#" ng-click="setTab('sliceYZ')">Transect 2</a></li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane" ng-class="{active: tab == 'surface'}">
                            <leaflet-map active="tab == 'surface'" set-handler="addAnimationHandler(handler)" on-click="mapClicked(point)" marker="chartPoint" data="surfaceData" init="initMap" draw="drawTemperatureOverlay">
                                <loading ng-hide="tDataReady">
                                </loading>
                            </leaflet-map>
                            <color-legend colors="LEGEND_COLORS" extent="surfaceExtent" label="Temperature (&deg;C)"></color-legend>
                        </div>
                        <div class="tab-pane" ng-class="{active: tab == 'sliceXZ'}">
                            <pixi-canvas active="tab == 'sliceXZ'" set-handler="addAnimationHandler(handler)" on-click="sliceClicked(point)" marker="chartPoint" data="sliceXZData" draw="drawTemperatureOverlay" source="sliceXZ" label-left="Geneva" label-right="Villeneuve" map-img-src="img/slice1.png">
                                <loading ng-hide="tDataReady">
                                </loading>
                            </pixi-canvas>
                            <color-legend colors="LEGEND_COLORS" extent="sliceXZExtent" label="Temperature (&deg;C)"></color-legend>
                        </div>
                        <div class="tab-pane" ng-class="{active: tab == 'sliceYZ'}">
                            <pixi-canvas active="tab == 'sliceYZ'" set-handler="addAnimationHandler(handler)" on-click="sliceClicked(point)" marker="chartPoint" data="sliceYZData" draw="drawTemperatureOverlay" source="sliceYZ" label-left="Evian" label-right="Lausanne" map-img-src="img/slice2.png">
                                <loading ng-hide="tDataReady">
                                </loading>
                            </pixi-canvas>
                            <color-legend colors="LEGEND_COLORS" extent="sliceYZExtent" label="Temperature (&deg;C)"></color-legend>
                        </div>
                    </div>

                    <d3-chart set-handler="addAnimationHandler(handler)" data="chartData" label="Temperature (&deg;C)" on-close="closeChart()"></d3-chart>
                </div>

                <div ng-controller="VelocityCtrl" class="col-sm-12 col-lg-6 lv-extra-padding">
                    <h3>Water Velocity</h3>

                    <ul class="nav nav-tabs">
                        <li class="active"><a>Surface</a></li>
                    </ul>

                    <leaflet-map active="true" set-handler="addAnimationHandler(handler)" on-click="mapClicked(point)" marker="chartPoint" data="surfaceData" draw="drawVelocityOverlay">
                        <loading ng-hide="vDataReady">
                        </loading>
                    </leaflet-map>
                    <color-legend colors="LEGEND_COLORS" extent="surfaceExtent" label="Velocity (m/s)"></color-legend>
                    <d3-chart set-handler="addAnimationHandler(handler)" data="chartData" label="Velocity (m/s)" on-close="closeChart()"></d3-chart>
                </div>
            </div>
        </div>

        <nav class="navbar navbar-inverse navbar-fixed-bottom">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bottomNav" style="float:left;margin-left:15px" >
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <!--<a class="navbar-brand" href="#">Lake 3D Model</a>-->
                </div>
                <div class="collapse navbar-collapse" id="bottomNav">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Model</a></li>
                        <li><a href="#">Remote Sensing</a></li>
                        <li><a href="{{ BUCHILLON_URL }}">In-situ Measurements</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-78739267-1', 'auto');
            ga('send', 'pageview');
        </script>
    </body>
</html>
